___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_WVCBZ",
  "version": 1,
  "displayName": "Matomo Analytics - E-commerce Tracking",
  "brand": {
    "id": "github.com_data-marketing-school",
    "displayName": "data-marketing-school",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Matomo e-commerce tag.",
  "containerContexts": [
    "WEB"
  ],
  "securityGroups": []
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "ecommerceAction",
    "displayName": "Ecommerce Event Type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "categoryView",
        "displayValue": "Category View"
      },
      {
        "value": "productView",
        "displayValue": "Product View"
      },
      {
        "value": "cartUpdate",
        "displayValue": "Cart Update"
      },
      {
        "value": "order",
        "displayValue": "Order"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "categoryView",
    "alwaysInSummary": true
  },
  {
    "type": "LABEL",
    "name": "label1",
    "displayName": "Trigger this tag on \u003cb\u003eadd_to_cart\u003c/b\u003e and \u003cb\u003eremove_from_cart\u003c/b\u003e events. By default this tag maps \u003ca href\u003d\"https://developers.google.com/analytics/devguides/collection/ga4/reference/events?client_type\u003dgtm\"\u003eGA4 standard\u003c/a\u003e to Matomo, override items array below if necessary.",
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "cartUpdate",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "productId",
    "displayName": "Product ID (or SKU)",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "productView",
        "type": "EQUALS"
      }
    ],
    "valueHint": "1234"
  },
  {
    "type": "TEXT",
    "name": "categoryName",
    "displayName": "Category Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "categoryView",
        "type": "EQUALS"
      },
      {
        "paramName": "ecommerceAction",
        "paramValue": "productView",
        "type": "EQUALS"
      }
    ],
    "valueHint": "Books"
  },
  {
    "type": "TEXT",
    "name": "productName",
    "displayName": "Product Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "productView",
        "type": "EQUALS"
      }
    ],
    "valueHint": "Percy Jackson"
  },
  {
    "type": "TEXT",
    "name": "productPrice",
    "displayName": "Product Price",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "productView",
        "type": "EQUALS"
      }
    ],
    "valueHint": "9.99"
  },
  {
    "type": "TEXT",
    "name": "orderId",
    "displayName": "Order ID",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "order",
        "type": "EQUALS"
      }
    ],
    "valueHint": "12345678"
  },
  {
    "type": "TEXT",
    "name": "totalRevenue",
    "displayName": "Total Revenue",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "order",
        "type": "EQUALS"
      }
    ],
    "valueHint": "129.9"
  },
  {
    "type": "TEXT",
    "name": "subTotal",
    "displayName": "Subtotal",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "order",
        "type": "EQUALS"
      }
    ],
    "valueHint": "12.9"
  },
  {
    "type": "TEXT",
    "name": "tax",
    "displayName": "Tax",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "order",
        "type": "EQUALS"
      }
    ],
    "valueHint": "3.9"
  },
  {
    "type": "TEXT",
    "name": "shipping",
    "displayName": "Shipping",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "order",
        "type": "EQUALS"
      }
    ],
    "valueHint": "2.8"
  },
  {
    "type": "TEXT",
    "name": "discount",
    "displayName": "Discount",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "order",
        "type": "EQUALS"
      }
    ],
    "valueHint": "2.2"
  },
  {
    "type": "GROUP",
    "name": "overrideItemsArrayKeys",
    "displayName": "Override items array",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "cartProductsArray",
        "displayName": "Override Items Array Value",
        "simpleValueType": true,
        "enablingConditions": [],
        "help": "Default is: \u003cb\u003eecommerce.items\u003c/b\u003e. If different, please provide a value here.",
        "valueHint": "{{DLV - detail.products}}"
      },
      {
        "type": "TEXT",
        "name": "productIdKey",
        "displayName": "Override Product Id Key",
        "simpleValueType": true,
        "enablingConditions": [],
        "valueHint": "item_id",
        "help": "By default, this tag will take item_id as the product id in the products array."
      },
      {
        "type": "TEXT",
        "name": "productNameKey",
        "displayName": "Override Product Name Key",
        "simpleValueType": true,
        "enablingConditions": [],
        "valueHint": "item_name",
        "help": "By default, this tag will take item_name as the product name in the products array."
      },
      {
        "type": "TEXT",
        "name": "productCategoryKey",
        "displayName": "Override Product Category Key",
        "simpleValueType": true,
        "enablingConditions": [],
        "valueHint": "item_category",
        "help": "By default, this tag will take item_category as the product category in the products array."
      },
      {
        "type": "TEXT",
        "name": "productPriceKey",
        "displayName": "Override Product Price Key",
        "simpleValueType": true,
        "enablingConditions": [],
        "valueHint": "price",
        "help": "By default, this tag will take price as the product price in the products array."
      },
      {
        "type": "TEXT",
        "name": "productQuantityKey",
        "displayName": "Override Product Quantity Key",
        "simpleValueType": true,
        "enablingConditions": [],
        "valueHint": "quantity",
        "help": "By default, this tag will take quantity as the product quantity in the products array."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "ecommerceAction",
        "paramValue": "cartUpdate",
        "type": "EQUALS"
      },
      {
        "paramName": "ecommerceAction",
        "paramValue": "order",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require("logToConsole");
const copyFromWindow = require("copyFromWindow");
const callInWindow = require("callInWindow");
const copyFromDataLayer = require("copyFromDataLayer");
const makeNumber = require("makeNumber");
const makeString = require("makeString");
const JSON = require("JSON");
const localStorage = require("localStorage");
const ecommerce = copyFromDataLayer("ecommerce");
const event = copyFromDataLayer("event");
const CART_KEY = "mtm_cart_155c56";

function isMatomoSet() {
  const _paq = copyFromWindow("_paq");
  if (_paq) {
    return true;
  }
  log("Error: _paq variable not set, \"Matomo Analytics - E-commerce Tracking\" should only be triggered after \"Matomo Analytics - Configuration\" tag.");
  data.gtmOnFailure();
  return false;
}

if(isMatomoSet()) {
  
  if(data.ecommerceAction == "categoryView") {
    callInWindow("_paq.push", ["setEcommerceView", false, false, data.categoryName || ecommerce.items[0].item_category]);
  }
  
  if(data.ecommerceAction == "productView") {
    callInWindow("_paq.push", ["setEcommerceView", data.productId || ecommerce.items[0].item_id, data.productName || ecommerce.items[0].item_name || false, data.categoryName || ecommerce.items[0].item_category || false, data.productPrice || ecommerce.items[0].price || false]);
  }
  
  if(data.ecommerceAction == "cartUpdate") {
    
    let total = 0;
    
    if(event == "add_to_cart" && ecommerce.items) {
      ecommerce.items.forEach(function(item) {
        addProductToCart(item);
      });
    } else if(event == "remove_from_cart" && ecommerce.items) {
      ecommerce.items.forEach(function(item) {
        removeProductFromCart(item);
      });
    }
    
    getCart().forEach(function(item) {
      total += item[data.productQuantityKey || "quantity"] * item[data.productPriceKey || "price"];
    });
     
    callInWindow("_paq.push", ["trackEcommerceCartUpdate", total]);
  }
  
  if(data.ecommerceAction == "order") {
    
    let products = data.cartProductsArray || ecommerce.items;
    
    products.forEach(function(product){
      callInWindow("_paq.push", ["addEcommerceItem",
        product[data.productIdKey || "item_id"],
        product[data.productNameKey || "item_name"],
        product[data.productCategoryKey || "item_category"],
        product[data.productPriceKey || "price"],
        product[data.productQuantityKey || "quantity"]]);
    });
    
    callInWindow("_paq.push", ["trackEcommerceOrder", 
      makeString(data.orderId || ecommerce.transaction_id),
      makeNumber(data.totalRevenue || ecommerce.value),
      data.subTotal || false,
      data.tax != undefined && data.tax || ecommerce != undefined && ecommerce.tax || false,
      data.shipping != undefined && data.shipping || ecommerce != undefined && ecommerce.shipping || false,
      data.discount != undefined && data.discount || ecommerce != undefined && ecommerce.discount || false
    ]);
    
    removeCart();
    
  }

}

function addProductToCart(productToAdd) {
  let cart = getCart();
  
  let existingProduct;

  for (var i = 0; i < cart.length; i++) {
    if (cart[i][data.productIdKey || "item_id"] === productToAdd[data.productIdKey || "item_id"]) {
      existingProduct = cart[i];
      break;
    }  
  }
    
  if (existingProduct) {
    
    existingProduct[data.productQuantityKey || "quantity"] += productToAdd[data.productQuantityKey || "quantity"] || 1;
    
    callInWindow("_paq.push", ["addEcommerceItem", existingProduct[data.productIdKey || "item_id"], existingProduct[data.productNameKey || "item_name"], existingProduct[data.productCategoryKey || "item_category"], existingProduct[data.productPriceKey || "price"], existingProduct[data.productQuantityKey || "quantity"]]);
    
  } else {
    
    cart.push(productToAdd);
    
    callInWindow("_paq.push", ["addEcommerceItem", productToAdd[data.productIdKey || "item_id"], productToAdd[data.productNameKey || "item_name"], productToAdd[data.productCategoryKey || "item_category"], productToAdd[data.productPriceKey || "price"], productToAdd[data.productQuantityKey || "quantity"]]);
    
  }
  
  saveCart(cart);
  
}

function removeProductFromCart(productToRemove) {
   
  let productIndex = -1;
  let cart = getCart();

  for (var i = 0; i < cart.length; i++) {
    if (cart[i][data.productIdKey || "item_id"] === productToRemove[data.productIdKey || "item_id"]) {
      productIndex = i;
      break;
    }
  }
  
  if (productIndex !== -1) {
    
    let product = cart[productIndex];
    
    if ((product[data.productQuantityKey || "quantity"] - productToRemove[data.productQuantityKey || "quantity"]) > 0) {
      
      product[data.productQuantityKey || "quantity"] = product[data.productQuantityKey || "quantity"] - productToRemove[data.productQuantityKey || "quantity"];
      
      callInWindow("_paq.push", ["addEcommerceItem", product[data.productIdKey || "item_id"], product[data.productNameKey || "item_name"], product[data.productCategoryKey || "item_category"], product[data.productPriceKey || "price"], product[data.productQuantityKey || "quantity"]]);
      
    } else {
      
      cart.splice(productIndex, 1);
      callInWindow("_paq.push", ["removeEcommerceItem", product[data.productIdKey || "item_id"]]);
      
    }
    
    saveCart(cart);
      
  }

}

function getCart() {
  return localStorage.getItem(CART_KEY) ? JSON.parse(localStorage.getItem(CART_KEY)) : [];
}

function saveCart(cart) {
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
}

function removeCart() {
  localStorage.removeItem(CART_KEY);
  callInWindow("_paq.push", ["clearEcommerceCart"]);
}
  
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_paq.push"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_paq"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedKeys",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "event"
              },
              {
                "type": 1,
                "string": "ecommerce"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_local_storage",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "mtm_cart_155c56"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: [
  {
    name: "Typical Order",
    setup: "const setInWindow = require(\"setInWindow\");\n\nsetInWindow(\"_paq\", {}, true);",
    code: "const mockData = {\n  cartProductsArray: [\n    {\n      affiliation: \"Parenthèse\",\n      coupon: \"0.00\",\n      currency: \"EUR\",\n      location_id: \"Chambon-la-Forêt\",\n      discount: 21.9,\n      item_category: \"TINY_HOUSE\",\n      item_name: \"Arion\",\n      item_id: \"6ad7dbca-bc91-4b28-b1bd-2892b48ee325\",\n      item_list_id: \"45f7f344-d5bf-4b93-9ef7-d8342a13045a\",\n      item_list_name: \"Parenthèse\",\n      item_variant: \"\",\n      price: 210,\n      quantity: 2\n    }\n  ],\n  orderId: \"FY9S8\",\n  discount: 0,\n  totalRevenue: 419.7,\n  ecommerceAction: \"order\",\n  subTotal: 418.7,\n  tax: 1.0\n};\n\nrunCode(mockData);\n\nassertApi('gtmOnSuccess').wasCalled();"
  }
]



___NOTES___

Created on 16/05/2024, 15:00:16


